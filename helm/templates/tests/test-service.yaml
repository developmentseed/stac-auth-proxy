apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "stac-auth-proxy.fullname" . }}-test-service"
  labels:
    {{- include "stac-auth-proxy.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  containers:
    - name: test
      image: busybox
      command:
        - sh
        - -c
        - |
          # Test service type is set to a valid value
          service_type="{{ .Values.service.type }}"
          valid_types="ClusterIP NodePort LoadBalancer"
          
          if ! echo "$valid_types" | grep -w "$service_type" > /dev/null; then
            echo "Invalid service type: $service_type"
            exit 1
          fi
          
          # Test service port is set and is a valid port number
          port="{{ .Values.service.port }}"
          if [ -z "$port" ] || [ "$port" -lt 1 ] || [ "$port" -gt 65535 ]; then
            echo "Invalid service port: $port"
            exit 1
          fi
          
          echo "Service configuration is valid"
  restartPolicy: Never
